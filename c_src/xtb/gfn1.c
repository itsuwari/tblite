#include "gfn1.h"

/* Hubbard parameters for GFN1-xTB (Z=1..86) */
const double gfn1_hubbard_parameter[86] = {
    0.470099, 1.441379, 0.205342, 0.274022, 0.340530,
    0.479988, 0.476106, 0.583349, 0.788194, 0.612878,
    0.165908, 0.354151, 0.221658, 0.438331, 0.798319,
    0.643959, 0.519712, 0.529906, 0.114358, 0.134187,
    0.778545, 1.044998, 0.985157, 0.468100, 0.609868,
    0.900000, 0.426680, 0.367019, 0.260192, 0.209459,
    0.193302, 0.800000, 0.732367, 0.714534, 0.732530,
    0.820312, 0.075735, 0.122861, 0.351290, 0.168219,
    0.175875, 0.384677, 0.405474, 0.305394, 0.293973,
    0.280766, 0.472978, 0.130828, 0.132120, 0.480655,
    0.564406, 0.400301, 0.520472, 0.935394, 0.085110,
    0.137819, 0.495969, 0.350000, 0.342306, 0.334612,
    0.326917, 0.319223, 0.311529, 0.303835, 0.296140,
    0.288446, 0.280752, 0.273058, 0.265364, 0.257669,
    0.249975, 0.269977, 0.239696, 0.243663, 0.362512,
    0.354318, 0.290898, 0.370447, 0.496380, 0.334997,
    0.671316, 1.000000, 0.944879, 1.091248, 1.264162,
    0.798170
};

/* Offsets for shell Hubbard scaling (per element, l=0..2) */
static const double shell_hubbard_delta[86][3] = {
    { 0.0,       0.0000000, 0.0000000 },
    { 0.0,      -0.0772012, 0.0000000 },
    { 0.0,       0.1113005, 0.0000000 },
    { 0.0,       0.0165643, 0.0000000 },
    { 0.0,      -0.0471181, 0.0000000 },
    { 0.0,       0.0315090, 0.0000000 },
    { 0.0,       0.0374608, 0.0000000 },
    { 0.0,      -0.0827352, 0.0000000 },
    { 0.0,      -0.3892542, 0.0000000 },
    { 0.0,      -0.3004391, 0.0000000 },
    { 0.0,       0.0674819, 0.0000000 },
    { 0.0,       0.0503564, 0.0000000 },
    { 0.0,      -0.5925834, 0.0000000 },
    { 0.0,      -0.2530875, 0.0000000 },
    { 0.0,      -0.1678147, 0.0000000 },
    { 0.0,      -0.4481841, 0.0000000 },
    { 0.0,      -0.1450000, 0.0000000 },
    { 0.0,      -0.5332978, 0.0000000 },
    { 0.0,       1.1522018, 0.0000000 },
    { 0.0,      -0.2000000,-0.5934820 },
    { 0.0,      -0.1500000,-0.7388986 },
    { 0.0,      -0.2000000,-0.5229338 },
    { 0.0,      -0.2500000, 0.0786859 },
    { 0.0,      -0.2500000, 1.0544199 },
    { 0.0,      -0.2000000, 0.1018896 },
    { 0.0,      -0.2000000, 0.0222849 },
    { 0.0,      -0.2000000, 0.1282426 },
    { 0.0,       0.0000000,-0.1290373 },
    { 0.0,       0.0200991, 0.0000000 },
    { 0.0,      -0.2021175, 0.1000000 },
    { 0.0,      -0.7631942,-0.1300000 },
    { 0.0,      -0.0335509,-0.1000000 },
    { 0.0,      -0.3213580,-0.2500000 },
    { 0.0,      -0.1440020,-0.1000000 },
    { 0.0,      -0.3743296, 0.0000000 },
    { 0.0,      -0.5181667, 0.0000000 },
    { 0.0,      -0.8003590, 0.0000000 },
    { 0.0,      -0.0800000,-0.4159186 },
    { 0.0,      -0.2500000, 0.0337914 },
    { 0.0,      -0.2000000, 0.0638436 },
    { 0.0,      -0.2500000,-0.3426221 },
    { 0.0,      -0.2000000, 0.2642680 },
    { 0.0,      -0.1500000, 0.1772831 },
    { 0.0,      -0.2500000, 0.3782936 },
    { 0.0,      -0.2500000, 0.3210802 },
    { 0.0,      -0.1500000,-0.1477715 },
    { 0.0,      -0.0775216, 0.0000000 },
    { 0.0,       0.0762515, 0.0000000 },
    { 0.0,      -0.3444851,-0.1500000 },
    { 0.0,      -0.1459812,-0.2000000 },
    { 0.0,       0.0137154,-0.2000000 },
    { 0.0,      -0.0387987,-0.1500000 },
    { 0.0,      -0.3435282,-0.1500000 },
    { 0.0,      -0.7035550, 0.0000000 },
    { 0.0,      -0.8801363, 0.0000000 },
    { 0.0,      -0.1500000,-0.6396752 },
    { 0.0,      -0.1500000,-0.5245538 },
    { 0.0,      -0.1500000,-0.5064761 },
    { 0.0,      -0.1500000,-0.4883984 },
    { 0.0,      -0.1500000,-0.4703207 },
    { 0.0,      -0.1500000,-0.4522429 },
    { 0.0,      -0.1500000,-0.4341652 },
    { 0.0,      -0.1500000,-0.4160875 },
    { 0.0,      -0.1500000,-0.3980098 },
    { 0.0,      -0.1500000,-0.3799321 },
    { 0.0,      -0.1500000,-0.3618544 },
    { 0.0,      -0.1500000,-0.3437767 },
    { 0.0,      -0.1500000,-0.3256989 },
    { 0.0,      -0.1500000,-0.3076212 },
    { 0.0,      -0.1500000,-0.2895435 },
    { 0.0,      -0.1500000,-0.1485678 },
    { 0.0,      -0.1500000,-0.1870583 },
    { 0.0,      -0.1500000, 0.0130920 },
    { 0.0,      -0.2000000, 0.2507095 },
    { 0.0,      -0.1000000,-0.0262294 },
    { 0.0,      -0.1500000, 0.3805255 },
    { 0.0,      -0.2000000, 0.0996400 },
    { 0.0,      -0.1500000,-0.4380921 },
    { 0.0,      -0.4204099, 0.0000000 },
    { 0.0,      -0.8101017, 0.0000000 },
    { 0.0,      -0.7925216, 0.0000000 },
    { 0.0,      -0.7150589, 0.0000000 },
    { 0.0,      -0.3955914, 0.0000000 },
    { 0.0,      -0.3402676, 0.0000000 },
    { 0.0,      -0.2380762, 0.0000000 }
};

double gfn1_shell_hubbard_value(int l, int z) {
    return 1.0 + shell_hubbard_delta[z-1][l];
}

void gfn1_shell_hardness(size_t natoms, const int *nums, const int *nsh_id,
                         const int *cgto_ang, size_t stride, double *hardness) {
    for (size_t isp = 0; isp < natoms; ++isp) {
        int izp = nums[isp];
        for (int ish = 0; ish < nsh_id[isp]; ++ish) {
            int il = cgto_ang[isp*stride + ish];
            hardness[isp*stride + ish] =
                gfn1_hubbard_parameter[izp-1] * gfn1_shell_hubbard_value(il, izp);
        }
        for (int ish = nsh_id[isp]; ish < (int)stride; ++ish) {
            hardness[isp*stride + ish] = 0.0;
        }
    }
}

